

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MongoKit &mdash; MongoKit 0.8.0 documentation</title>
    
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="MongoKit 0.8.0 documentation" href="index.html" />
    <link rel="next" title="Getting Started with MongoKit" href="tutorial.html" />
    <link rel="prev" title="MongoKit Documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Getting Started with MongoKit"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="MongoKit Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MongoKit 0.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MongoKit</a><ul>
<li><a class="reference internal" href="#philosophy">Philosophy</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#a-quick-example">A quick example</a></li>
<li><a class="reference internal" href="#recent-change-log">Recent Change Log</a><ul>
<li><a class="reference internal" href="#v0-8-0">v0.8.0</a></li>
<li><a class="reference internal" href="#v0-7-2">v0.7.2</a></li>
<li><a class="reference internal" href="#v0-7-1">v0.7.1</a></li>
<li><a class="reference internal" href="#v0-7">v0.7</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">MongoKit Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="next chapter">Getting Started with MongoKit</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mongokit">
<h1>MongoKit<a class="headerlink" href="#mongokit" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://www.mongodb.org/display/DOCS/Home">MongoDB</a> is a great schema-less document oriented database. It have a lot of
driver for many langages (python, ruby, perl, java, php...).</p>
<p>MongoKit is a python module that brings structured schema and validation layer
on top of the great pymongo driver. It has be written to be as simple and light
as possible with the KISS and DRY principles in mind.</p>
<div class="section" id="philosophy">
<h2>Philosophy<a class="headerlink" href="#philosophy" title="Permalink to this headline">¶</a></h2>
<p>MongoKit is designed to be:</p>
<blockquote>
<div><ul class="simple">
<li><strong>simple</strong>: MongoKit use plain python type to describe document structure</li>
<li><strong>fast</strong>: MongoKit is fast but if you <em>really</em> need to be fast you have access to the raw pymongo layer without changing the API</li>
<li><strong>powerful</strong>: MongoKit brings many feature like document auto-reference, custom types or i18n support.</li>
</ul>
</div></blockquote>
<div class="topic">
<p class="topic-title first"><strong>Your data is clean</strong>:</p>
<p>&#8220;Tools change, not data&#8221;. In order to follow this &#8220;credo&#8221;, MongoKit won&#8217;t
add any information into your data saved into the database.
So if you need to use other mongo tools or ODMs in other languages, your
data won&#8217;t be polluted by MongoKit&#8217;s stuff.</p>
</div>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>schema validation (wich use simple python type for the declaration)</li>
<li>schema less feature</li>
<li>doted notation</li>
<li>nested and complex schema declaration</li>
<li>untyped field support</li>
<li>required fields validation</li>
<li>default values</li>
<li>custom validators</li>
<li>cross database document reference</li>
<li>random query support (which returns a random document from the database)</li>
<li>inheritance and polymorphisme support</li>
<li>versionized document support (in beta stage)</li>
<li>partial auth support (it brings a simple User model)</li>
<li>operator for validation (currently : OR, NOT and IS)</li>
<li>simple web framework integration</li>
<li>import/export to json</li>
<li>i18n support</li>
<li>GridFS support</li>
<li>document migration support</li>
</ul>
</div></blockquote>
<p>Go to the full <a class="reference external" href="http://namlook.github.com/mongokit/">documentation</a> .</p>
</div>
<div class="section" id="a-quick-example">
<h2>A quick example<a class="headerlink" href="#a-quick-example" title="Permalink to this headline">¶</a></h2>
<p>Document are enhanced python dictionary with a <tt class="docutils literal"><span class="pre">validate()</span></tt> method.
A Document declaration look like that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@connection.register</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;body&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;author&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;date_creation&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;rank&#39;</span><span class="p">:</span><span class="nb">int</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="s">&#39;date_creation&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rank&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;date_creation&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">}</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>We fire a connection and register our objects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">BlogPost</span><span class="p">()</span> <span class="c"># this use the db &quot;test&quot; and the collection &quot;example&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;my title&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;a body&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;me&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span>
<span class="go">{&#39;body&#39;: u&#39;a body&#39;, &#39;title&#39;: u&#39;my title&#39;, &#39;date_creation&#39;: datetime.datetime(...), &#39;rank&#39;: 0, &#39;author&#39;: u&#39;me&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blogpost</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Saving the object will call the <cite>validate()</cite> method.</p>
<p>And you can use more complex structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span> <span class="nd">@connection.register</span>
<span class="gp">... </span> <span class="k">class</span> <span class="nc">ComplexDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__database__</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">__collection__</span> <span class="o">=</span> <span class="s">&#39;example&#39;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;foo&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s">&quot;bar&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;bla&#39;</span><span class="p">:{</span><span class="s">&#39;spam&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;foo.content&#39;</span><span class="p">,</span> <span class="s">&#39;bar.bla.spam&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Please, see the <a class="reference external" href="http://namlook.github.com/mongokit/tutorial.html">tutorial</a> for more examples.</p>
<p>Suggestion and patches are really welcome. If you find mistakes in the documentation
(english is not my primary langage) feel free to contact me. You can find me (namlook)
on the freenode #mongodb irc channel or on <a class="reference external" href="http://twitter.com/namlook">twitter</a>.</p>
</div>
<div class="section" id="recent-change-log">
<h2>Recent Change Log<a class="headerlink" href="#recent-change-log" title="Permalink to this headline">¶</a></h2>
<div class="section" id="v0-8-0">
<h3>v0.8.0<a class="headerlink" href="#v0-8-0" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Add spec file for rpm-based distributions (Merge pull request #63 from linuxnow/master)</li>
<li>change document size limitation for mongodb 1.8 or later. Thanks to Aleksey Sivokon (Merge pull request #74 from key/master)</li>
<li>validation of &#8220;&#8221; for an int (Merge pull request #79 from barnybug/master)</li>
<li>Fix exception when loading documents with a custom type field missing (Merge pull request #80 from barnybug/master)</li>
<li>Big documentation restructuration made by Sean Lynch (Merge pull request #82 from sean-lynch/master)</li>
<li>Using rename no longer causes migrations throw an exception (Merge pull request #86 from matthewh/master)</li>
<li>Some test is modified and added tox (Merge pull request #91 from aircastle/modifiytest)</li>
<li>Replace pymongo.objectid with bson.objectid (Merge pull request #88 from behackett/master)</li>
<li>Added Support for additional keyword-arguments for index-creation (Merge pull request #85 from mfelsche/master)</li>
<li>Remove anyjson dependency and use builtin json instead</li>
</ul>
</div></blockquote>
<p>Thank you all for all your patches !</p>
</div>
<div class="section" id="v0-7-2">
<h3>v0.7.2<a class="headerlink" href="#v0-7-2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>add inherited queries support (please see <a class="reference external" href="http://github.com/namlook/mongokit/wiki/Inherited-queries">http://github.com/namlook/mongokit/wiki/Inherited-queries</a> for more details)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="v0-7-1">
<h3>v0.7.1<a class="headerlink" href="#v0-7-1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>change MongokitMasterSlaveConnection to MasterSlaveConnection for consistency</li>
<li>fix #57 &#8211; support pymongo &gt; 1.9 in grid.py</li>
<li>fix #45 &#8211; remove automatique index creation</li>
<li>fix #43 &#8211; slicing a cursor should return a mongokit document, not dict</li>
<li>Dont try to convert None struct to json (patch from &#64;mLewisLogic thanks !)</li>
<li>fix schemaless issue (thanks to Mihai Pocorschi for reporting it)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="v0-7">
<h3>v0.7<a class="headerlink" href="#v0-7" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first">add <cite>use_schemaless</cite> feature ! please see the documentation for more informations</p>
</li>
<li><dl class="first docutils">
<dt>Add equality test for mongokit operators (thanks to &#64;allancaffee)</dt>
<dd><p class="first last">This allows developers to write unit tests on the structure
of their document classes when operators are used</p>
</dd>
</dl>
</li>
<li><p class="first">roll back find_and_modify for master branch (need pymongo 1.10 for that)</p>
</li>
<li><p class="first">many documentation fixes</p>
</li>
<li><p class="first">fix #55 &#8211; Bug in VersionedDocument remove() method</p>
</li>
<li><p class="first">fix #53 &#8211; Fixed a few spelling errors in README</p>
</li>
<li><p class="first">fix #52 &#8211; Advanced bulk migration docs example is broken</p>
</li>
<li><p class="first">fix #51 &#8211; pymongo.dbref is deprecated, use bson.dbref instead</p>
</li>
<li><p class="first">fix #49 &#8211; Can&#8217;t specify default values for lists of embedded objects</p>
</li>
<li><p class="first">fix #48 &#8211; uuid.UUID support</p>
</li>
<li><p class="first">fix #41 &#8211; add basestring to authorized types</p>
</li>
<li><p class="first">fix #40 &#8211; Made some enhancements</p>
</li>
<li><p class="first">fix #39 &#8211; KeyError when saving partially loaded documents</p>
</li>
<li><p class="first">fix #34 &#8211; add find_and_modify method to Document</p>
</li>
<li><p class="first">fix #32 &#8211; allow the structure to be empty (was: document.to_json())</p>
</li>
<li><p class="first">fix #24 &#8211; Don&#8217;t handle __database__/__collection__ attribute for virtual documents</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Getting Started with MongoKit"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="MongoKit Documentation"
             >previous</a> |</li>
        <li><a href="index.html">MongoKit 0.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Nicolas Clairon.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>